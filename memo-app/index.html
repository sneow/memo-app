<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>익명 메모장</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA 설정 -->
    <link rel="manifest" href="manifest.json">

    <style>
        body { font-family: sans-serif; padding: 20px; }
        #log { margin-top: 20px; color: #444; }
        textarea {
            width: 100%; height: 300px;
            padding: 12px; font-size: 16px;
        }
    </style>
</head>
<body>

<h2>익명 메모장</h2>

<textarea id="memo" placeholder="여기에 메모하세요..."></textarea>

<div id="log"></div>

<script>
    /* ---- 오프라인 메모 저장 ---- */
    const memo = document.getElementById("memo");
    memo.value = localStorage.getItem("memo") || "";

    memo.addEventListener("input", () => {
        localStorage.setItem("memo", memo.value);
    });

    /* ---- 웹소켓 (실시간 입장/퇴장) ---- */
    let log = document.getElementById("log");
    let ws = new WebSocket("ws://localhost:3001");

    ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);

        if (data.type === "join") {
            log.innerHTML += `<div><b>${data.name}</b> 님이 입장했습니다.</div>`;
        }

        if (data.type === "leave") {
            log.innerHTML += `<div><b>${data.name}</b> 님이 나갔습니다.</div>`;
        }
    };
</script>

</body>
</html>
